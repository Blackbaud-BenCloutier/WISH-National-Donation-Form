<script>
(function ($) {
  var level1 = (((urlVariableArray['level1'] < 1 || isNaN(urlVariableArray['level1']))) ? (30) : (Math.floor(urlVariableArray['level1']))),
    level2 = (((urlVariableArray['level2'] < 1 || isNaN(urlVariableArray['level2']))) ? (50) : (Math.floor(urlVariableArray['level2']))),
    level3 = (((urlVariableArray['level3'] < 1 || isNaN(urlVariableArray['level3']))) ? (100) : (Math.floor(urlVariableArray['level3'])));
    chid = '[[S80:chid]]',
    chapter_prefix = chid.substring(0, 3),
    getNextMonth = function() {
      var dayOfMonth = Date.today().toString('d');
      if (dayOfMonth == '29' || dayOfMonth == '30' || dayOfMonth == '31') {
        return Date.today().moveToFirstDayOfMonth().addMonths(2).toString('M/d/yyyy');
      } else {
        return Date.today().next().month().toString('M/d/yyyy');
      }
    },
    searchForChapters = function(search_value, local_or_international){
      $('ul.search-menu').html('<li id="no_valid_region"><a>Matching Result Not Found!</a></li>');
      if(parseInt(search_value)) {
        $.getJSON('../assets/js/zip-codes.json', function (data) {
          $(data['chapter']).each(function (index, arr) {
            var chapter_id = arr['chapter_id'];
            if (arr['zip_code'] == search_value) {
              $(chaptersjson['allChapters']['chapter']).each(function (index, arr) {
                if(local_or_international == 'local'){
                  if(parseInt(chapter_id.substr(0,3)) < 500) {
                    if (arr['office_id'] == chapter_id) {
                      $('ul.search-menu').html('<li><a href="#" data-office-id="' + chapter_id + '" class="chapter-btn">' + arr['office_name'] + '</a></li>');
                      window.formFundID = arr['fund_id'];
                      return;
                    }
                  }
                } else {
                  if(parseInt(chapter_id.substr(0,3)) >= 500) {
                    if (arr['office_id'] == chapter_id) {
                      $('ul.search-menu').html('<li><a href="#" data-office-id="' + chapter_id + '" class="chapter-btn">' + arr['office_name'] + '</a></li>');
                      window.formFundID = arr['fund_id'];
                      return;
                    }
                  }
                }
              });
            }
          });
        });
      } else {
        if (search_value.length > 2) {
          $(chaptersjson['allChapters']['chapter']).each(function (index, arr) {
            var office_name_regex = new RegExp(search_value,'i'),
            chapter_id = arr['office_id'];
            if(local_or_international == 'local'){
              if(parseInt(chapter_id.substr(0,3)) < 500) {
                if(office_name_regex.test(arr['office_name'])) {
                  $('#no_valid_region').remove();
                  $('ul.search-menu').html($('ul.search-menu').html() + '<li><a href="#" data-office-id="' + chapter_id + '" class="chapter-btn">' + arr['office_name'] + '</a></li>');
                }
              }
            } else {
              if(parseInt(chapter_id.substr(0,3)) >= 500) {
                if(office_name_regex.test(arr['office_name'])) {
                  $('#no_valid_region').remove();
                  $('ul.search-menu').html($('ul.search-menu').html() + '<li><a href="#" data-office-id="' + chapter_id + '" class="chapter-btn">' + arr['office_name'] + '</a></li>');
                }
              }
            }
          });
        }
      }
    };
  $('.nextMonth').each(function () {
    $(this).append(getNextMonth());
  });
  $('a.state-btn').click(function (e) {
    e.preventDefault();
    var state = $(this).text();
    var stateResults = [];
    var $chapterResults = $('.js-chapter-results ul');
    $chapterResults.html('');
    $(chaptersjson['allChapters']['chapter']).each(function (index, arr) {
      if (arr['state_province'] == state) {
        stateResults.push([arr['office_id'], arr['office_name']])
      }
    }); //each loop
    for (var i = 0; i < stateResults.length; i++) {
      var stateResult = stateResults[i]
      $chapterResults.append('<li><a class="chapter-btn" data-office-id="' + stateResult[0] + '" href="#" >' + stateResult[1] + '</a></li>');
    }
  });
  $(document).on('keyup', '.js_donationDest', function (e) {
    searchForChapters($(this).val(), 'local');
  });
  $(document).on('keyup', '.js_donationToCountry', function (e) {
    searchForChapters($(this).val(), 'international');
  });
  for (var index in urlVariableArray) {
    if (index.substring(0, 2) == "s_") {
      donation_data = donation_data + "&" + index + "=" + urlVariableArray[index];
    }
  }
  if (chid && chid != "100-000") {
    var orgChapterName = "";
    var orgCenter = "";
    $(chaptersjson['allChapters']['chapter']).each(function (index, arr) {
      if (arr['office_id'] == chid) {
        orgChapterName = arr['office_name'];
        orgCenter = arr['center_id'];
        mawf.donation_init({
          localizedCurrencySymbol: '$',
          donorIntentId: chid,
          donorIntentName: orgChapterName,
          donationType1Label: 'A Single Donation',
          donationType2Label: 'A Monthly Pledge',
          minimumDonation: '5',
          donationAmt1: level1,
          donationAmt2: level2,
          donationAmt3: level3,
          startDate1: 5,
          startDate2: 20,
          clearFormMessage: 'Clearing the form will remove all your entered information. Are you sure you wish to proceed?',
          clearFormBtnYes: 'Yes, clear form',
          clearFormBtnNo: 'No, take me back to the form',
          nationalID: '100-000',
          nationalName: 'Make-A-Wish® America',
          internationalID: '500-000',
          internationalName: 'Make-A-Wish® International',
          purchaserID: chid,
          purchaserName: orgChapterName,
          sitChapterID: chid,
          sitChapter: orgChapterName,
          sitCenter: orgCenter
        });
        return false;
      }
    });
  } else {
    mawf.donation_init({
      localizedCurrencySymbol: '$',
      donorIntentId: '100-000',
      donorIntentName: 'Make-A-Wish® America',
      donationType1Label: 'A Single Donation',
      donationType2Label: 'A Monthly Pledge',
      minimumDonation: '5',
      donationAmt1: level1,
      donationAmt2: level2,
      donationAmt3: level3,
      startDate1: 5,
      startDate2: 20,
      clearFormMessage: 'Clearing the form will remove all your entered information. Are you sure you wish to proceed?',
      clearFormBtnYes: 'Yes, clear form',
      clearFormBtnNo: 'No, take me back to the form',
      nationalID: '100-000',
      nationalName: 'Make-A-Wish® America',
      internationalID: '500-000',
      internationalName: 'Make-A-Wish® International',
      purchaserID: '100-000',
      purchaserName: 'Make-A-Wish® America',
      sitChapterID: '100-000',
      sitChapter: 'Make-A-Wish® America',
      sitCenter: '1001'
    });
  }
  if (chid && chid != "100-000") {
    $('#localOptin').insertBefore('#nationalOptin');
    $('.intouch-container:eq(0)').addClass('selected');
    $('.intouch-container:eq(0) input').prop('checked', true);
    $("input[name='s_sat_chapter_id']").val(chid);
  } else {
    $("input[name='s_sat_chapter_id']").val("100-000");
  }
})(jQuery);
</script>